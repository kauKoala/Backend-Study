### 1. 헤더

![image](https://github.com/kauKoala/Backend-Study/assets/79046106/fbea655b-2efa-4ebe-987c-6c0115b0729a)

Transport Layer의 포트번호처럼 MAC 주소와 IP 주소에도 시작, 목적지 2개의 값이 들어있음

IP 헤더는 IP 주소를 가지고 있고, 이더넷 헤더는 MAC 주소를 가지고 있음

![image](https://github.com/kauKoala/Backend-Study/assets/79046106/5436db0c-a525-4ffd-90ad-9949f2dd4f0b)

- MTU
    - Maximum Transmission Unit
    - IP 헤더부터 데이터까지의 크기
- MSS
    - Maximum Segment Size
    - TCP에서 데이터를 전송할 수 있는 최대 크기

### 2. 상대방 라우터까지 보내는 방법

상대방의 IP 주소는 DNS에 질의해서 알아냈으니 이제 라우터를 통해 상대방 라우터에 패킷을 보냄

라우터는 라우팅 알고리즘을 통해 전체적인 경로를 설정하고, 중간에 받는 라우터는 패킷을 받으면 포워딩을 통해 적절한 경로로 이동시킬 수 있게 해줌

- 라우팅: 패킷의 출발지부터 목적지까지 경로를 설정하는 것
- 포워딩: 라우터의 입력 포트에서 출력 포트까지 패킷을 이동시키는 것
    - 라우팅 테이블(포워딩 테이블): 목적지 IP 주소를 기반으로 패킷을 다음 목적지로 전송하는 정보가 기록된 테이블

### 3. 상대방 MAC 주소를 찾는 방법

상대방 주소

- 포트 번호: HTTP 통신을 가정하면 80번 포트로 약속되어 있음
- IP 주소: DNS에 질의해서 알아냄
- MAC 주소: FF:FF:FF:FF:FF:FF 패킷을 보내고, 수신측은 ARP 요청 패킷를 통해 알아냄

관련 네트워크 기기

- 라우터: 서로 다른 IP 주소로 보낼 때 사용하는 기기
- 스위치: 서로 다른 MAC 주소로 보낼 때 사용하는 기기

찾는 방법 (아직 MAC 주소를 모르는 상황일 때)

- DNS로 IP 주소를 확인했으니 MAC 주소를 알아내기 위해 패킷을 수신측에 보냄
- 라우터에서 ARP 테이블에 IP 주소에 대응하는 MAC 주소가 이미 캐시되어 있는지 확인함
- 존재하지 않으면 스위치에서 브로드캐스트를 하여 스위치와 연결된 서브넷의 모든 호스트가 패킷을 받음
- 이때 자신의 IP에 해당하는 값이 있으면 ARP 응답 패킷을 보냄 (나머지는 패킷을 무시)
- 송신측 IP 주소로 MAC 주소를 보냄

### 4. 추가 정리

- ARP란 무엇인지?
    - IP 주소와 MAC 주소를 매칭 시키기 위한 프로토콜
- 스위치 테이블(MAC 주소 테이블)은 무엇인지?
    - MAC 주소와 포트 번호가 매칭되어 있는 테이블로 패킷을 받으면 테이블을 확인해 적절한 포트 번호로 보냄
    - 스위치 테이블도 ARP 통신을 통해 브로드캐스트하여 호스트의 IP 주소로 정보를 찾아냄
- 패킷을 보내는 순서
    1. 송신측은 DNS 서버를 통해 목적지 IP 주소 확인
    2. 송신측은 수신측으로 패킷을 보낼 때 FF:FF:FF:FF:FF:FF로 MAC 주소를 설정해서 보냄
    3. 수신측은 패킷을 받으면 ARP 패킷을 서브넷에 보내서 브로드캐스트를 통해 MAC 주소 확인
    4. 이후 송신측은 수신측에 연결할 기기의 MAC 주소를 보내줌
    5. TCP 3-way handshake 연결
    6. 데이터 패킷 전송
