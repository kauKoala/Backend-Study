### 상황

- 회사에서는 여러 서버를 두고 사용중인데, 이때 A서버에서 B서버에 API 호출을 했지만 실패한 상황
- 외부 API를 사용하는데, 외부 API에 요청 했지만 응답을 받지 못한 상태
- 대량의 데이터를 디비에 적재하는데, 일부 데이터가 등록되지 않았을 때

### 방법 1 - 단순 재시도, 특정 시간 후에 재전송

- 일시적인 네트워크 장애에서 사용해볼만함
- 예외 상황) 선착순 쿠폰과 같이 특정 시간대에 사람들이 몰린 경우
    - 사람들이 몰렸을 때 재전송을 하면 네트워크 요청이 더 늘어나서 장애가 지속됨
    - 일정 시간 후에 재전송을 해도 네트워크 요청이 많은 시간대를 전부 재전송하기 때문에 장애가 지속됨

### 방법 2 - Exponential Backoff

- 점진적으로 재전송 시간을 늘리는 전략 (100ms → 200ms → 400ms → 800ms → …)
- 예외 상황) 특정 시간대에 사람들이 몰린 경우 해당 방법을 사용해도 지수적인 시간에 네트워크 장애가 지속됨
  - 특정 시간에 집중된 요청을 분산해야하는 방법이 필요함

### 방법 3 - Jitter

- 각 요청마다 랜덤한 시간을 추가하여 재전송하는 방식
- 재시도 횟수가 증가할수록 네트워크 요청이 몰린 시간대의 요청들이 점점 분산된다.
- AWS에서는 Exponential Backoff + Jitter를 사용해 재전송한다.
(https://aws.amazon.com/ko/blogs/architecture/exponential-backoff-and-jitter/)

### 이후엔…

재전송은 무한히 할 수 없으니 결국에는 로직 처리 실패를 하는 경우도 생긴다.

출처

- https://jungseob86.tistory.com/12
- https://mingrammer.com/dynamodb-batch-retry-with-exponential-backoff/
